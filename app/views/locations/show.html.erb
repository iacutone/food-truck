<div class='container-fluid'>
	<div class='row-fluid'>
		<div class='span3'>
		<p class='make_bold'>Manhattan Food Truck Finder</p>
		<% if @locations == [] %>
			No recent tweets.
		<% else %>
			Recent tweets by:
				<ul><%- @locations.each do |l| %>
					<li><%= l.truck.name %></li>
				<% end %>
				</ul>
			<% end %>
		</div>
		<div class='span9'>
			<div id="map-canvas">
				<script type="text/javascript">
					function initialize() {
					  var mapOptions = {
					    center: new google.maps.LatLng(40.768483, -73.981248),
					    zoom: 12,
					    mapTypeId: google.maps.MapTypeId.ROADMAP
					  };

					  var map = new google.maps.Map(document.getElementById("map-canvas"),mapOptions);
						
						<% @locations.each do |location| %>

							var markerPosition = new google.maps.LatLng(<%= location.latitude %>, <%= location.longitude %>);

							var marker<%= location.id %> = new google.maps.Marker({
						            position: markerPosition
						          });

							marker<%= location.id %>.setMap(map);

							var contentString = '<div><p>Food Truck: <%= location.truck.name %></br>' + 'Tweet: <%= location.twitter_text.gsub('&amp', '&') %>'+ '</br>Tweeted at: <%= time_formater(location.time).strftime('%I:%M %p') %></p></div>';

				      infowindow<%= location.id %> = new google.maps.InfoWindow({
				      	content: contentString,
				      	maxWidth: 200
				      });

					    google.maps.event.addListener(marker<%= location.id %>, 'click', function(event) {
					      infowindow<%= location.id %>.open(map, this);
					      currentMark = this;

					    });

					   google.maps.event.addListener(map, 'click', function() {
            		infowindow<%= location.id %>.close();

          		});

						<% end %>
					}

					google.maps.event.addDomListener(window, 'load', initialize);
				</script>
			</div>
		</div>
	</div>
</div>
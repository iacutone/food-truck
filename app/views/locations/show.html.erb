<div class='container-fluid'>
	<div class='row-fluid'>
		<div class='span3'>
		<p class='make_bold'>Manhattan Food Truck Finder</p>
		<% if @locations == [] %>
			No recent tweets.
		<% else %>
			Recent tweets by:
				<ul><%- @locations.sort_by(&:time).reverse.each do |l| %>
					<li id='<%= l.id %>'><a href="javascript:void(<%= l.id %>)" rel="tooltip" class='trucks'><%= l.truck.name %>, <%= time_ago_in_words(Time.parse(l.time)) %></a></li>
				<% end %>
				</ul>
			<% end %>
		</div>
		<div class='span9'>
			<div id="map-canvas">
				<script type="text/javascript">
					function initialize() {
					  var mapOptions = {
					    center: new google.maps.LatLng(40.768483, -73.981248),
					    zoom: 12,
					    mapTypeId: google.maps.MapTypeId.ROADMAP
					  };

					  var map = new google.maps.Map(document.getElementById("map-canvas"),mapOptions);
						
						<%- @locations.each do |location| %>

							var markerPosition = new google.maps.LatLng(<%= location.latitude %>, <%= location.longitude %>);

							var marker<%= location.id %> = new google.maps.Marker({
						            position: markerPosition,
						            map: map
						          });

							var contentString<%= location.id %> = '<div><p>Food Truck: <%= location.truck.name %></br>' + 'Tweeted at: <%= time_formater(location.time).strftime('%I:%M %p') %></br></p></div>';

				      var infowindow<%= location.id %> = new google.maps.InfoWindow({
				      	content: contentString<%= location.id %>,
				      	maxWidth: 350
				      });

					    google.maps.event.addListener(marker<%= location.id %>, 'click', function() {
							  infowindow<%= location.id %>.open(map, marker<%= location.id %>);
							});

							google.maps.event.addListener(map, 'click', function() {
							  infowindow<%= location.id %>.close(map, marker<%= location.id %>);
							  map.setZoom(12);
							});

							$('#<%= location.id %>').click(function(){
								google.maps.event.trigger(marker<%= location.id %>, 'click');
								map.setZoom(16);
								map.panTo(marker<%= location.id %>.position);
							});

					<% end %>
					}

					google.maps.event.addDomListener(window, 'load', initialize);
				</script>
			</div>
		</div>
	</div>
</div>